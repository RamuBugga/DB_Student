DROP PROCEDURE IF EXISTS [dbo].[USP_GET_StaffDetails];
GO

CREATE PROCEDURE [dbo].[USP_GET_StaffDetails]
(
    @InstitutionID INT,
    @UserRoleID INT,
    @StaffRoleID INT
)
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
       S.StaffID,
        S.StaffCode,
        S.InstitutionID,
        ISNULL(R.RoleName, '') AS StaffRoleName,
        ISNULL(U.RoleName, '') AS UserRole,
        S.StaffGUID,
        S.StaffReferenceCode,
        S.FirstName,
        S.MiddleName,
        S.LastName,
        S.FullName,
        S.Gender,
        S.DOB,
        S.CountryCode,
        ISNULL(S.MobileNo, '') AS MobileNo,
        S.EmailID,
        S.Qualification,
        S.NoOfYearsExperience,
        SC.CampusID,
        C.CampuseName,
        S.Address
    FROM StaffDetails S WITH (NOLOCK)
    INNER JOIN UserRoles U WITH (NOLOCK) 
        ON U.UserRoleID = S.UserRoleID
    INNER JOIN StaffRoles R WITH (NOLOCK) 
        ON R.StaffRoleID = S.StaffRoleID
    LEFT JOIN StaffToCampuses SC WITH (NOLOCK) 
        ON SC.StaffID = S.StaffID AND SC.IsAssign = 1
    LEFT JOIN Campuses C WITH (NOLOCK) 
        ON C.CampusID = SC.CampusID
    WHERE 
        S.InstitutionID = @InstitutionID
        AND (@UserRoleID IS NULL OR S.UserRoleID = @UserRoleID)
        AND (@StaffRoleID IS NULL OR S.StaffRoleID = @StaffRoleID)
    ORDER BY 
        S.FullName;
END;
GO
